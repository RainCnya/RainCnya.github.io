---
title: 单调性优化体系 (Monotonicity System)
tags:
  - DP/优化
  - 单调性/单调队列
categories:
  - 01_Patchouli
  - 03_动态规划
  - 03_维度优化
abbrlink: 1bc8a91b
date: 2025-12-16 23:10:00
updated: 2025-12-24 20:45:01
---

# 单调性优化体系

## 1. 生态位

- **定义**: 通过挖掘转移方程中的单调性特征，利用单调队列（Deque）或多路队列，将转移复杂度从 $O(K)$ 甚至 $O(\log N)$ 强行降至 $O(1)$ 的维度打击技术。
    
- **解决痛点**: 解决了多重背包 $O(V \log C)$ 瓶颈、定长区间最值查询以及高频产出元素的排序开销问题。
    
## 2. 逻辑支点

- **核心公式 (解耦原理)**:
    
    $$f[ i ] = \max_{j \in [L_i, R_i]} \{ g[ j ] \} + val[ i ]$$
    - **不变量**: 当 $j$ 依赖项与 $i$ 依赖项彻底分离时，滑窗最值即可生效。
        
- **同余分组 (Congruence Splitting)**:
    
    - 针对多重背包，容量 $j$ 仅能由 $j - k \cdot w$ 转移。利用 $j \pmod w$ 将 $dp$ 数组划分为 $w$ 条互不干涉的独立决策链。
        
- **隐性单调性 (Implicit Monotonicity)**:
    
    - **渗透点**: 如果先被处理的元素 $A$ 产生的后继 $A'$ 天然优于后处理元素 $B$ 产生的 $B'$（产出即有序），则无需使用 $O(\log N)$ 的堆，直接使用 $O(1)$ 的队列。
        

## 3. 实战部署

### 3.1 显性单调队列模板 (以滑窗最值为例)

{% fold info @Code: Monotonic Queue Template %}

```cpp
deque< int > q;
for( int i = 1; i <= n; ++ i )
{
    // 1. 窗口右移：新元素 i 进入，剔除队尾不如 i 的冗余决策
    while( !q.empty( ) && f[ q.back( ) ] <= f[ i ] )
    {
        q.pop_back( );
    }
    q.push_back( i );

    // 2. 窗口收缩：移除超出范围 [i - k + 1, i] 的过期决策
    while( !q.empty( ) && q.front( ) < i - k + 1 )
    {
        q.pop_front( );
    }

    // Result: f[ q.front( ) ] 为当前窗口最优值
}
```

{% endfold %}

### 3.2 隐性多路队列 (蚯蚓模型思维)

{% fold info @Code: Multi-Queue Ordering %}

```cpp
// 核心：利用三路队列维护原长、切分左、切分右，保证各队列内部单调
int get_max( )
{
    int res = -2e9, choice = 0;
    for( int i = 1; i <= 3; ++ i )
    {
        if( !q[ i ].empty( ) && q[ i ].front( ) > res )
        {
            res = q[ i ].front( );
            choice = i;
        }
    }
    q[ choice ].pop_front( );
    return res;
}
```

{% endfold %}

## 4. 知识粘附

- **变体模型**:
    
    - [倍增优化体系](../倍增优化体系.md): 当窗口不是滑动的而是跳跃的时，使用 ST 表或倍增。
        
    - [复合模型与逆向思维](../复合模型与逆向思维.md): 斜率优化 (Slope Optimization) —— 针对含有 $i \cdot j$ 项的非线性单调性优化。
        
- **母题索引**:
    
    - [P1714 切蛋糕 (MQ_DP_PrefixSum)](P1714%20切蛋糕%20(MQ_DP_PrefixSum).md) —— 前缀和单调性应用。
        
    - [P1725 琪露诺 (MQ_DP_Jump)](P1725%20琪露诺%20(MQ_DP_Jump).md) —— 步长约束下的滑窗最值。
        
    - [P1070 道路游戏 (MQ_DP_Limit_Window)](P1070%20道路游戏%20(MQ_DP_Limit_Window).md) —— 对角线分组后的单调优化。
        
    - [[P2569 股票交易 (MQ_DP_MultiState)]] —— 复杂状态下的滑窗解耦。
        
    - [[P3800 Power 收集 (MQ_DP_Grid_Movement)]] —— 网格逐行优化。
        