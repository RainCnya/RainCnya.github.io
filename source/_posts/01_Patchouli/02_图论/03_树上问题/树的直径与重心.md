---
title: 树的直径与重心 (Tree_Prop_Diameter_Centroid)
tags:
  - 树论/直径
  - 树论/重心
  - 算法/贡献法
categories:
  - 01_Patchouli
  - 02_图论
  - 03_树上问题
abbrlink: 447bed30
date: 2025-12-16 14:00:00
updated: 2025-12-24 19:08:01
---
# 树的直径与重心

## 1. 生态位

- **树的直径**: 树的物理结构由其“跨度”决定。直径代表了树的物理极限，即树上最长的简单路径。它定义了树的物理“跨距”，是处理最远点对查询、巡逻路径优化及偏心距计算的核心性质。
    
- **树的重心**: 树的物理结构由其“平衡点”决定。重心代表了树的拓扑对称中心，是删除该点后产生的最大子树节点数最小的点。理解重心是处理复杂树上路径与分治问题的逻辑起点，旨在通过质心切割保证递归深度的对数级控制（$O(\log N)$）。
    

## 2. 逻辑支点

- **直径的端点特质**: 从树上**任意**一点 $u$ 出发，能走到的最远节点 $v$，一定是直径的一个端点。
    
- **重心的平衡不变量**: 以重心为根时，所有子树的大小均不超过 $N/2$。
    
- **渗透点**:
    
    - 直径是树的“脊梁”，任何点到树上最远点的路径，最终都会汇合到直径的某个端点。
        
    - 重心是树的“质心”，在重心处进行切割能最大程度地瓦解树的连通规模。
        

## 3. 实战部署

### 3.1 树的直径 (两遍 DFS/BFS)

适用于**非负权边**。若有负权，必须改用树形 DP。

{% fold info @Code: Tree Diameter %}

```cpp
int max_len = 0, endpoint = 0;

void dfs_diam( int u, int fa, int dist )
{
    if( dist > max_len )
    {
        max_len = dist;
        endpoint = u;
    }
    for( auto &e : adj[ u ] )
    {
        if( e.v != fa )
        {
            dfs_diam( e.v, u, dist + e.w );
        }
    }
}
// Usage: dfs_diam( 1, 0, 0 ); int p1 = endpoint; max_len = 0; dfs_diam( p1, 0, 0 );
```

{% endfold %}

### 3.2 树的重心

{% fold info @Code: Tree Centroid %}

```cpp
int sz[ maxn ], f[ maxn ], root = 0;

void get_root( int u, int fa, int total_n )
{
    sz[ u ] = 1;
    f[ u ] = 0;
    for( int v : adj[ u ] )
    {
        if( v == fa )
        {
            continue;
        }
        get_root( v, u, total_n );
        sz[ u ] += sz[ v ];
        f[ u ] = max( f[ u ], sz[ v ] );
    }
    f[ u ] = max( f[ u ], total_n - sz[ u ] );
    if( !root || f[ u ] < f[ root ] )
    {
        root = u;
    }
}
```

{% endfold %}

## 4. 知识粘附

- **变体模型**:
    
    - **树的中心**: 直径的中点，最小化到所有叶子的最大距离。
        
    - **动态重心**: 树链剖分维护重心漂移。
        
- **母题索引**:
    
    - [P1395 会议 (Centroid_MinDist)](P1395%20会议%20(Centroid_MinDist).md)
        
    - [CF1406C Link Cut Centroids (Centroid_LinkCut)](CF1406C%20Link%20Cut%20Centroids%20(Centroid_LinkCut).md)
        
    - [CF911F Tree Destruction (Diameter_Constructive)](CF911F%20Tree%20Destruction%20(Diameter_Constructive).md)
        
    - [P1099 树网的核 (Diameter_Core)](P1099%20树网的核%20(Diameter_Core).md)
        
    - [P3629 巡逻 (Diameter_Greedy)](P3629%20巡逻%20(Diameter_Greedy).md)