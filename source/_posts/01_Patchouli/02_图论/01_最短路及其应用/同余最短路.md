---
title: 同余最短路 (Modulo Shortest Path)
tags:
  - 图论/最短路
  - 数论/同余系
categories:
  - 01_Patchouli
  - 02_图论
  - 01_最短路及其应用
abbrlink: cd9dd626
updated: 2025-12-24 19:05:11
---
# 同余最短路 (Modulo Shortest Path)

## 1. 生态位

- **定义**: 同余最短路利用模运算将巨大或无限的值域空间折叠进有限的同余环中，通过寻找每个余数类的“最小进入代价”，实现从无限组合到有限路径的周期归一化映射。它本质上是值域空间的“周期缩放”，将 $O(B)$ 的背包问题优化为 $O(m \log m)$ 的图论搜索。
    
- **解决痛点**: 解决了大容量完全背包的可行性判定与计数问题，特别是当物品权值较小而目标和极大时。
    

## 2. 逻辑支点

- **核心不变量**: 周期性覆盖。若模 $m$ 余 $r$ 的最小值 $dist[r]$ 被凑出，则所有 $dist[r] + k \cdot m$ 均可被凑出。
    
- **建图逻辑**: 选取 $m = \min(a_i)$ 为模数。对于其他系数 $a_k$，建立边：
    
    $$u \xrightarrow{a_k} (u + a_k) \pmod{m}$$
- **渗透点 (Penetration)**: 想象一个模 $a_1$ 的表盘。每次累加系数就在表盘上跳跃。$dist[r]$ 就是跳到刻度 $r$ 所需走过的全球最短路程。
    

## 3. 实战部署

{% fold info @Code: Modulo Shortest Path (Dijkstra) %}

```cpp
// 设 a[ 1 ] 为模数 mn
void solve( )
{
    for( int i = 0; i < mn; ++ i )
    {
        dist[ i ] = inf;
    }
    dist[ 0 ] = 0;
    priority_queue< PLI, vector< PLI >, greater< PLI > > pq;
    pq.push( { 0, 0 } );

    while( !pq.empty( ) )
    {
        auto [ d, u ] = pq.top( );
        pq.pop( );

        if( d > dist[ u ] )
        {
            continue;
        }

        for( int i = 2; i <= n; ++ i )
        {
            int v = ( u + a[ i ] ) % a[ 1 ];
            if( dist[ u ] + a[ i ] < dist[ v ] )
            {
                dist[ v ] = dist[ u ] + a[ i ];
                pq.push( { dist[ v ], v } );
            }
        }
    }
}
```

{% endfold %}

## 4. 知识粘附

- **变体模型**:
    
    - **双模数优化**: 处理跨余数类的复杂数论约束。
        
    - **跳跃限制**: 结合分层图限制特定系数的使用频率。
        
    - [差分约束系统](../差分约束系统.md): 另一类经典的图论映射模型，利用最短路逻辑解决代数不等式组。
        
- **母题索引**:
    
    - [P2371 [墨墨的等式]](https://www.luogu.com.cn/problem/P2371 "null") —— 同余最短路标准判定模型。
        
    - [P3403 [跳楼机]](https://www.luogu.com.cn/problem/P3403 "null") —— 典型的值域折叠应用。