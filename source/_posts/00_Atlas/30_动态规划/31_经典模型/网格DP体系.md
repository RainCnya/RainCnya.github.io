---
title: 网格DP (Grid DP System)
tags:
  - DP/线性
  - 算法/多路并发
categories:
  - 01_Patchouli
  - 03_动态规划
  - 01_基础模型
abbrlink: fbbfeb81
date: 2025-12-16 22:15:00
---
# 网格DP体系

## 1. 生态位

- **定义**: 状态定义在二维坐标 $(i, j)$ 或其高维扩展上，利用网格的步进方向（通常为向右、向下）自然建立 DAG 拓扑序。
    
- **解决痛点**: 解决了网格图中的路径计数、最值规划、多路径互斥以及基于局部连通性的覆盖问题。
    
- **核心不变量**: **方向性即序**。只要移动方向不产生回路，坐标本身就是天然的阶段标识。
    

## 2. 逻辑支点

- **模型坍缩**:
    
    - **单路模型**: $f[ i ][ j ]$ 仅由 $(i-1, j)$ 或 $(i, j-1)$ 转移。
        
    - **多路并发 (The Concurrent Model)**: 当存在多条路径且需处理重合点权值时，利用**步数** $k = r + c$ 锁定各路径的同步状态，实现维度坍缩。
        
- **对称性抽象**: 在复杂的网格计数（如中国象棋 P2051）中，利用列的统计特征（炮的数量）替代具体坐标，将 $O(2^M)$ 状态压缩至多项式级别。
    
- **渗透点 (Penetration)**:
    
    > 网格 DP 是物理空间对逻辑空间的降维。 每一步移动都是一次状态迁移。对于多路 DP，关键在于找到那个**时空同步频率**（通常是步数 $k$），从而在同一个时间切面上处理路径间的物理冲突。
    

## 3. 实战部署

### 3.1 多路并发路径 (以 P1006 传纸条为例)

{% fold info @Code: Concurrent Grid Paths %}

```cpp
// 核心：利用 k = r1 + c1 = r2 + c2 实现同步转移
for( int k = 2; k <= n + m; ++ k )
{
    // 强制 r1 < r2 以在物理上规避非起终点的重合
    for( int r1 = 1; r1 <= n; ++ r1 )
    {
        for( int r2 = r1 + 1; r2 <= n; ++ r2 )
        {
            int c1 = k - r1, c2 = k - r2;
            if( c1 < 1 || c1 > m || c2 < 1 || c2 > m ) continue;

            int &res = f[ k ][ r1 ][ r2 ];
            // 四种决策组合：(右, 右), (右, 下), (下, 右), (下, 下)
            res = max( { f[ k - 1 ][ r1 ][ r2 ], 
                         f[ k - 1 ][ r1 - 1 ][ r2 ], 
                         f[ k - 1 ][ r1 ][ r2 - 1 ], 
                         f[ k - 1 ][ r1 - 1 ][ r2 - 1 ] } );
            
            res += a[ r1 ][ c1 ] + a[ r2 ][ c2 ];
        }
    }
}
```

{% endfold %}

### 3.2 行级滚动优化 (Row-level Scrolling)

针对大规模网格，利用 $O(M)$ 空间维护上一行状态。

## 4. 知识粘附

- **变体模型**:
    
    - [单调性优化体系](单调性优化体系.md): 针对行间转移跨度较大的场景（如 P3800），引入单调队列加速。
        
    - [状压DP体系](状压DP体系.md): 插头 DP (Plug DP) —— 处理基于网格连通性的极致计数。
        
- **母题索引**:
    
    - [P1004 方格取数 (Grid_Concurrent_Pickup)](P1004%20方格取数%20(Grid_Concurrent_Pickup).md) —— 多路 DP 权值去重范式。
        
    - [P1006 传纸条](P1006%20传纸条.md) —— 互斥路径状态约束。
        
    - [P1758 管道取珠 (Grid_Walking_Conversion)](P1758%20管道取珠%20(Grid_Walking_Conversion).md) —— 平方和向双路同步步进的数学映射。
        
    - [P2051 中国象棋 (Opt_Contour_State)](P2051%20中国象棋%20(Opt_Contour_State).md) —— 典型列特征统计抽象。
        
    - [P3800 Power 收集](P3800%20Power%20收集.md) —— 结合单调队列的行级优化。