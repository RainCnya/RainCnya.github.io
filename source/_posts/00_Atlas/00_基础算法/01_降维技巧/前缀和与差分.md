---
title: '[Note] 前缀和与差分'
tags:
  - 逆运算/前缀和
  - 逆运算/差分
  - 难度/P1/基础
categories:
  - 00_Atlas
  - 00_基础算法
  - 01_降维技巧
abbrlink: 2a057462
date: 2026-01-17
---
# [L4] 前缀和与差分

## 1. 生态位

- **识别**:
    
    1. 题目涉及大量重复的静态区间求和查询。
        
    2. 题目涉及大量重复的区间统一增减修改。
        
- **地位**: 核心基础算法。空间换时间，高效解决区间查询和区间修改。
    
- **用途**: 将 $O(N)$ 的区间扫描，通过预处理转化为 $O(1)$ 的点位读取。

## 2. 逻辑支点

- **核心原理：存账本**:
    
    - **物理直觉**：前缀和相当于记“余额”，差分相当于记“流水”。
	    - 你想知道某段时间存了多少钱，只需拿今天的余额减去开始前的余额（**前缀和**）；
	    - 你想给某段时间每天加钱，只需在开始那天记一笔存入，在结束那天记一笔支取（**差分**）。
        
- **具体原理**:
    
    - **一维逆运算**：差分是前缀和的逆运算。$D[i] = A[i] - A[i-1]$。对区间 $[l, r]$ 加上 $v$，等价于 $D[l] += v, D[r+1] -= v$。
        
    - **二维容斥**：在多维空间中，利用容斥原理进行补偿。
        
        - 查询：$S[i][j] = S[i-1][j] + S[i][j-1] - S[i-1][j-1] + a[i][j]$。
            
        - 修改：通过四个顶点的修改来覆盖矩形区域。

## 3. 实战部署

{% fold info @代码实现: 二维前缀和与差分 %}

```cpp
// 预处理二维前缀和
for( int i = 1; i <= n; ++ i )
{
    for( int j = 1; j <= m; ++ j )
    {
        s[i][j] = s[i-1][j] + s[i][j-1] - s[i-1][j-1] + a[i][j];
    }
}

// 二维差分区间修改：给矩形 [x1, y1] -> [x2, y2] 增加 v
void add_2d( int x1, int y1, int x2, int y2, int v )
{
    d[x1][y1] += v;
    d[x2 + 1][y1] -= v;
    d[x1][y2 + 1] -= v;
    d[x2 + 1][y2 + 1] += v;
}
```

{% endfold %}

## 4. 知识关联

- **母题**: [[P2280 激光炸弹]] —— 二维前缀和最经典的逻辑体现。

- **实战案例**: [[ABC439D Kadomatsu Subsequence]] —— 动态维护前缀/后缀权值频率，实现 $O(N \log N)$ 的贡献度统计。