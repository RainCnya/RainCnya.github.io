---
title: '[Note] 素数筛法'
tags:
  - 数论/素数筛
  - 难度/P1/普及
categories:
  - 00_Atlas
  - 40_数学
  - 41_数论基础
abbrlink: aa0acc66
date: 2026-01-22 00:00:00
---
# 素数筛法
## 1. 生态位

- **识别**:
    
    1. 题目涉及多组询问，范围通常在 $[1, 10^6]$ 或更大。
        
    2. 需要批量获取质数，或处理积性函数（如 $\phi, \mu, d, \sigma$）。
        
- **地位**: 数论预处理的工具。将单次 $O(\sqrt{N})$ 的质性判定或函数计算，优化为全局 $O(N)$ 预处理 + $O(1)$ 查询。
    
- **用途**: 在 $O(N)$ 线性时间内，一次性打完整张数论属性表。

## 2. 逻辑支点

### 2.1 线性筛：

**埃氏筛的瓶颈**：在于一个合数会被多个质因子重复筛除（如 $12$ 被 $2$ 和 $3$ 各筛一次）。 

**线性筛核心**：规定每个合数 $X$ **有且仅有** 其**最小质因子** 为其负责。

### 2.2 积性函数

**定义**: 若 $\gcd(a, b) = 1$，则满足 $f(ab) = f(a)f(b)$。
    
利用线性筛遍历到每个数 $i \cdot p_j$ 时的状态，可以同步推导积性函数：

1. $i$ **为质数**：根据定义直接赋值。如 $\phi(p) = p-1, \mu(p) = -1$。
    
2. $\gcd(i, p_j) = 1$：利用积性性质。$f(i \cdot p_j) = f(i) \cdot f(p_j)$。
    
3. $p_j \mid i$（即 `i % pr[j] == 0`）：此时 $p_j$ 是 $i$ 的因子。
    
    - 对于 $\phi$：$\phi(i \cdot p_j) = \phi(i) \cdot p_j$。
        
    - 对于 $\mu$：$\mu(i \cdot p_j) = 0$（存在平方因子）。

## 3. 实战部署

{% fold info @线性筛全家桶 (质数 + 欧拉函数 + 莫比乌斯函数) %}

```cpp
int primes[maxn], cnt;
bool notPrime[maxn];
int phi[maxn], mu[maxn];

void sieve( int n )
{
    notPrime[0] = notPrime[1] = true;
    phi[1] = 1;
    mu[1] = 1;

    for( int i = 2; i <= n; ++ i )
    {
        if( !notPrime[i] )
        {
            primes[++ cnt] = i;
            phi[i] = i - 1;
            mu[i] = -1;
        }
        for( int j = 1; j <= cnt && i * primes[j] <= n; ++ j )
        {
            int next = i * primes[j];
            notPrime[next] = true;

            if( i % primes[j] == 0 )
            {
                // primes[j] 是 i 的因子，不满足互质
                phi[next] = phi[i] * primes[j];
                mu[next] = 0; // 包含平方因子 p^2
                break; // 核心：保证每个合数只被最小质因子筛掉
            }
            
            // primes[j] 小于 i 的最小质因子，利用积性性质
            phi[next] = phi[i] * (primes[j] - 1);
            mu[next] = -mu[i];
        }
    }
}

```

{% endfold %}

## 4. 知识关联

- **数学原理**: 
		
	- [[唯一分解定理]] —— 提供积性函数的定义与数学公式。
	
- **扩展应用**:
	    
    - [[欧拉定理与费马小定理]] —— 使用预处理好的 $\phi$ 进行大数降幂。
        
    - [[莫比乌斯反演]] —— 线性筛是反演技巧的基础工具。

- **高阶内容**：
	
	- [[杜教筛]]、[[Min_25 筛]]（亚线性筛法）。