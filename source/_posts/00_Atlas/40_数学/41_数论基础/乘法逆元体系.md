---
title: '[Note] 乘法逆元体系'
tags:
  - 数论/同余系
  - 难度/P1/普及
categories:
  - 00_Atlas
  - 40_数学
  - 41_数论基础
abbrlink: 4eb9ff09
date: 2026-01-25 00:00:00
---
# 乘法逆元体系

## 1. 生态位

- **识别**:
	
    1. 题目涉及除法取模：$\frac{a}{b} \pmod m$。
	
    2. 需要处理组合数计算、概率统计等逻辑。
        
- **地位**: 模运算的除法补丁，将除法运算转化为乘法运算。
    
- **用途**: 将模意义下的除法 $\frac{a}{b} \pmod m$ 转化为乘法 $a \cdot b^{-1} \pmod m$，其中 $b^{-1}$ 为 $b$ 的逆元。

## 2. 逻辑支点

### 2.1 核心原理：

在模 $m$ 意义下，若存在整数 $x$ 满足 $ax \equiv 1 \pmod m$，则称 $x$ 是 $a$ 的乘法逆元，记作 $a^{-1}$。，

- **逆元存在性条件**：$gcd(a, m) = 1$ ( $a$ 和 $m$ 互质)。

### 2.2 三大模型

1. **费马小定理模型**

	- **条件**：$m$ 必须是**质数**。
	- **推导**：$a^{m-1} \equiv 1 \pmod m$ 可得 $a \cdot a^{m-2} \equiv 1 \pmod m$
	- **结论**：$a^{-1} = a^{m-2} \pmod m$。快速幂实现，复杂度$O(\log m)$。

2. **扩展欧几里得模型**
	
	- **条件**：仅需要 $gcd(a, m) = 1$，不要求 $m$ 是质数。
	- **推导**：将 $ax \equiv 1 \pmod m$ 转化为线性同余方程 $ax + my = 1$。
	- **结论**：通过调用 [[扩展欧几里得与裴蜀定理 | ExGCD]]，求解出 $x$ 的特解即为逆元。

3. 线性递推模型

	- **场景**：需要 $O(N)$ 预处理 $1 \cdots N$ 范围内所有整数的逆元。
	- 
	- **推导**：
		- 设 $m = ki + r$，$ki + r \equiv 0 \pmod m \implies r \equiv -ki \pmod m$。
		- 两边同乘 $i^{-1} \cdot r^{-1}$ 得到：$i^{-1} = -k \cdot r^{-1} \pmod m$。

	- **结论**：$inv[i] = (m - m/i) \cdot inv[m\%i] \pmod m$。

## 3. 实战部署

{% fold info @逆元全家桶 %}

```cpp
// 1. 线性递推预处理 1..n 的逆元 (O(n))
void precomputeInv( int n, int mod )
{
    inv[1] = 1;
    for( int i = 2; i <= n; ++ i )
    {
        inv[i] = (ll)( mod - mod / i ) * inv[mod % i] % mod;
    }
}

// 2. 快速幂求逆元 (前提: mod 为质数, O(log mod))
ll getInvFermat( ll a, ll mod )
{
    ll b = mod - 2;
    ll res = 1;
    a %= mod;
    while( b > 0 )
    {
        if( b & 1 ) res = res * a % mod;
        a = a * a % mod;
        b >>= 1;
    }
    return res;
}

// 3. ExGCD 求逆元 (通用方案: 需保证 gcd(a, mod) == 1, O(log mod))
ll exgcd( ll a, ll b, ll &x, ll &y )
{
    if( b == 0 ) { x = 1; y = 0; return a; }
    ll d = exgcd( b, a % b, y, x );
    y -= ( a / b ) * x;
    return d;
}

ll getInvExGCD( ll a, ll mod )
{
    ll x, y;
    ll d = exgcd( a, mod, x, y );
    if( d != 1 ) return -1; // 无解
    return ( x % mod + mod ) % mod; // 确保结果为正数
}
```

{% endfold %}

## 4. 知识关联

- **前置知识**：
		
	- [[扩展欧几里得与裴蜀定理]]: 提供了求解线性同余方程的通用工具 ExGCD。
	    
	- [[素数筛法]]: 提供批量逆元预处理的工具。

- **扩展应用**:

	- [[组合数学]]: 计算 $C_n^m \pmod p$ 的核心前置步骤。
    
	- [[中国剩余定理]]: 在基底构造中必须使用逆元进行校准。

- **高阶内容**：
	
	- [[分治 FFT]]（多项式求逆）。