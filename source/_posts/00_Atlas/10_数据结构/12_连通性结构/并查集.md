---
title: "[Note] 并查集"
tags:
  - 数据结构/并查集
  - 连通性
  - 难度/P1/提高-
date: 2026-01-30
---
# 并查集

## 1. 生态位

- **识别**:
    
    1. **动态连通性**: 涉及元素所属集合的合并、查询以及连通分量的判定（如 Kruskal 算法）。
        
    2. **关系传递**: 存在传递性条件或复杂的约束条件。
        
    3. **不可逆删点**: 题目涉及删边、删点操作，但要求维护全局连通性。
        
- **地位**: 树形管理体系的基础工具。其常数几乎为常数级 $\alpha(N)$，是处理离散集合合并最轻量、最高效的工具。
    
- **用途**: 通过**路径压缩**与**合并策略**，维护森林的连通性。

## 2. 逻辑支点

### 2.1 等价关系

> 并查集本质上是维护集合 $S$ 上的一个等价关系 $\sim$。该关系必须满足：

1. **自反性**：$a \sim a$。
    
2. **对称性**：若 $a \sim b$，则 $b \sim a$。
    
3. **传递性**：若 $a \sim b$ 且 $b \sim c$，则 $a \sim c$。

**关键**: 并查集正是通过“根节点（代表元）”的唯一性，将复杂的传递性校验转化为 $O(1)$ 的代表元对比。

### 2.2 核心原理

1. **路径压缩**：
		
	- **逻辑**：在 `find` 过程中，将路径上所有点直接挂在到根节点上。
	- **意义**：通过星型拓扑加快查询，避免退化成链。

2. **按秩合并**：

	- **逻辑**：将 小树 合并到 大树 下。这里的**秩**可以是树的高度，也可以是树的节点数。
	- **意义**：同样是加快查询，限制树高。

### 2.3 扩展模型

1. **时光倒流模型**：
		
	- **逻辑**：将 “分裂/删除” 转化为 "合并/添加"。
	
2. **扩展域并查集**：
	
	- **逻辑**：将对立的逻辑关系转化为连通性问题。
	- **分析**：若 "$A$" 和 "$B$ 的敌人域" **联通**，则 $A, B$ 对立。
	
3. **权值并查集**：
		
	- **逻辑**：维护节点到根节点的相对关系或集合属性。
	- **分析**：每个节点同时存储一个权值 $d[x]$，合并时同时维护。

## 3. 实战部署

{% fold info @属性维护并查集 (带权值/规模维护) %}

```cpp
int fa[maxn], sz[maxn], edge[maxn];

void init( int n )
{
    for ( int i = 1; i <= n; ++ i )
    {
        fa[i] = i;
        sz[i] = 1;     // 初始集合点数为 1
        edge[i] = 0;   // 初始集合边数为 0
    }
}

int find( int x )
{
    // 路径压缩
    if( fa[x] == x ) return fa[x];
    else return fa[x] = find( fa[x] );
}

void merge( int x, int y )
{
    int rx = find( x ), ry = find( y );
    if( rx != ry )
    {
        // 核心逻辑：将 rx 族群并入 ry 族群
        fa[rx] = ry;
        sz[ry] += sz[rx];
        edge[ry] += edge[rx] + 1; // 两个集合合并产生 1 条新边
    }
    else
    {
        // 闭环边：不改变连通性，仅累加集合内部边数
        edge[ry] ++;
    }
}
```

{% endfold %}

## 4. 知识关联

- **实战案例**:
    
    - **时光倒流**: [[P1197 星球大战]]
        
    - **扩展域**: [[P1525 关押罪犯]]
        
    - **离散化**: [[P1955 程序自动分析]]
        
    - **属性/权值维护**: [[ZJ2020I Invoking the Magic]]、[[TZC25H 时空奇遇]]
        
- **横向联动**:
    
    - [[Kruskal]]: 并查集是维护最小生成树森林的重要工具。
        
    - [[二分图染色]]: 扩展域并查集是判别二分图的一种极简实现方案。