---
title: 优化建图技巧 (Graph_Optimization)
tags:
  - 图论/建模
  - 数据结构/线段树
categories:
  - 211_Patchouli
  - 02_图论
  - 00_建模与综述
abbrlink: 5c86f54
date: 2025-12-16 15:00:00
updated: 2025-12-24 19:05:59
---
# 优化建图技巧

## 1. 生态位

- **定义**: 优化建图是针对大规模边数（通常是 $O(N^2)$ 或区间连边）执行的降维打击。其核心在于引入“中转机制”，通过添加辅助性的虚拟节点或利用树形结构，将稠密的直连关系转化为稀疏的级联关系，从而使边数从平方级坍缩至对数级或线性级。
    
- **解决痛点**: 解决了集合间全连接、区间对节点连边、区间对区间连边导致的内存溢出（MLE）与时限超支（TLE）问题。
    

## 2. 逻辑支点

- **虚拟中转（Hub Node）**: 若集合 $A$ 中的每个点都需要向集合 $B$ 中的每个点连边，通过建立一个虚拟节点 $P$，将连边转化为 $A \to P \to B$，边数从 $|A| \cdot |B|$ 降至 $|A| + |B|$。
    
- **线段树优化建图**: 利用线段树的区间覆盖特性。建立两棵线段树（入树与出树），树内部节点向下/向上连权值为 0 的边。区间连边操作转化为在线段树上对 $O(\log N)$ 个区间节点进行连边。
    
- **渗透点**: 优化建图的本质是“熵减”。通过引入结构化的中转点，消除了重复的路径信息。线段树优化建图实际上是将拓扑空间进行了二分划分。
    

## 3. 实战部署

### 3.1 线段树优化建图 (Range-to-Node)

{% fold info @Code: Segment Tree Graph Optimization %}

```cpp
int ls[ maxn << 2 ], rs[ maxn << 2 ], tot;

// type 0: 入树 (从父向子连 0 边); type 1: 出树 (从子向父连 0 边)
void build( int &u, int l, int r, int type )
{
    u = ++ tot;
    if( l == r )
    {
        // 叶子节点连接对应的物理点
        if( type == 0 ) add_edge( u, l, 0 );
        else add_edge( l, u, 0 );
        return;
    }
    int mid = ( l + r ) >> 1;
    build( ls[ u ], l, mid, type );
    build( rs[ u ], mid + 1, r, type );
    
    if( type == 0 )
    {
        add_edge( u, ls[ u ], 0 );
        add_edge( u, rs[ u ], 0 );
    }
    else
    {
        add_edge( ls[ u ], u, 0 );
        add_edge( rs[ u ], u, 0 );
    }
}

// 区间连边：node -> [L, R]
void link( int u, int l, int r, int L, int R, int from, int w )
{
    if( L <= l && r <= R )
    {
        add_edge( from, u, w );
        return;
    }
    int mid = ( l + r ) >> 1;
    if( L <= mid ) link( ls[ u ], l, mid, L, R, from, w );
    if( R > mid ) link( rs[ u ], mid + 1, r, L, R, from, w );
}
```

{% endfold %}

## 4. 知识粘附

- **变体模型**:
    
    - **前缀/后缀优化建图**: 利用前缀和思想，建立链式虚拟点处理单向区间连边。
        
    - **位运算隐式建图**: 利用状态压缩或异或特性，在搜索过程中动态发现边。
        
- **母题索引**:
    
    - [[P1983 车站分级 (Virtual_Node)]] —— 虚拟 Hub 节点优化全连接。
        
    - [CF786B Legacy](https://www.luogu.com.cn/problem/CF786B "null") —— 线段树优化建图模板。