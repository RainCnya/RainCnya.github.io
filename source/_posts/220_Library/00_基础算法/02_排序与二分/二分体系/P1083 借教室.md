---
title: '[Leaf] [P1083] 借教室'
tags:
  - 策略/二分答案
  - 算法/前缀差分
  - 难度/P3
categories:
  - 220_Library
  - 00_基础算法
  - 02_排序与二分
abbrlink: 7b3df25b
updated: 2026-1-23
date: 2025-10-31 00:00:00
---
# [Luogu-P1083](https://www.luogu.com.cn/problem/P1083) 借教室

## 1. 题面梗概

**中译中**：给定 $n$ 天，和 $m$ 份订单。每天有 $r_i$ 个教室，每个订单租借从 $s_j \to t_j$ 的 $d_j$ 个教室。

问：是否有订单会无法完全满足，如果有，第一个不满足的订单是几号。

## 2. 逻辑推导

## 2.1 基础推导

第一想法肯定是暴力，暴力枚举每个订单，这样的复杂度是 $O(N \times M)$。这个思路没错，那我们就需要考虑降维复杂度了。

注意到，如果第 $k$ 个人满足，那么前 $k-1$ 个人都满足；如果第 $k$ 个人不满足，那么第 $k+1$ 个人也肯定不满足；

由此，我们发现了某种单调性，这也暗示着我们采用二分去找到那个分界点。

### 2.2 二分答案

首先我们要二分的是：能成功处理的订单数量 $k$。那么我们就需要构思 `check( mid )` 检验函数了。

对于前 $k$ 个订单，我们需要高效算出每一天被借走了多少教室，然后检验。

这中间涉及到大量**区间加减**，而由于我们只需要在最后查询，所以**静态处理**的**差分数组**就是关键。

> 动态处理(在线查询)：即询问之间有依赖性，必须强制完成前一次查询，才能继续处理下一次查询。对于这种情况，差分数组的效率就很低了，可以自己想想为什么。

最后再对差分数组进行一次前缀和计算，与 $r_i$ 比较即可完成检验。

## 3. 代码实现

{% fold info @AcCode %}

```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

const int maxn = 1e6 + 50;
ll r[maxn], d[maxn], s[maxn], t[maxn];
ll diff[maxn];
int n, m;

bool check( int k )
{
    memset( diff, 0, sizeof( diff ) );
    for( int i = 1; i <= k; ++ i )
    {
        diff[s[i]] += d[i];
        diff[t[i] + 1] -= d[i];
    }
    
    ll sum = 0;
    for( int i = 1; i <= n; ++ i )
    {
        sum += diff[i];
        if( sum > r[i] ) return 0;
    }
    return 1;
}

int main( )
{
    ios::sync_with_stdio( 0 );
    cin.tie( 0 );

    cin >> n >> m;
    for( int i = 1; i <= n; ++ i ) cin >> r[i];
    for( int i = 1; i <= m; ++ i ) cin >> d[i] >> s[i] >> t[i];
	
	// 特殊处理
    if( check( m ) )
    {
        cout << 0 << "\n";
        return 0;
    }
	
    int l = 1, r = m, ans = 0;
    while ( l <= r )
    {
        int mid = ( l + r ) >> 1;
        if ( check( mid ) ) l = mid + 1;
        // 这里我们的答案是 不满足条件 的情况！
        else ans = mid, r = mid - 1;
    }

    cout << -1 << "\n" << ans << "\n";
    return 0;
}
```

{% endfold %}

## 4. 复盘

- **复杂度**: $O( (N + M) \log M )$。
    
- **碎碎念**: 这属于**差分数组**+**二分答案**的经典模型。在这里的妙处在于它将“动态修改”转变成了“静态查询”。
        
- **关联笔记**: [[二分体系]] | [[前缀和与差分]]