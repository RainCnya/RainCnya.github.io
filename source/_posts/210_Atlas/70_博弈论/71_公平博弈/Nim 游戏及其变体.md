---
title: '[Note] Nim 游戏及其变体'
tags:
  - 数学/博弈/Nim
  - 难度/P2
categories:
  - 210_Atlas
  - 70_博弈论
  - 71_公平博弈
abbrlink: 90898f79
date: 2026-01-04 00:00:00
---
# Nim 游戏及其变体

## 1. 生态位

- **识别**: 明显的“多堆石子”描述，且可以一次性改变某一堆的状态。
    
- **地位**: 所有公平博弈的物理模型，异或逻辑的源头。
    
- **用途**: 绕过复杂的图搜索，直接通过 $O(N)$ 异或运算给出 $O(1)$ 的胜负结论。

## 2. 逻辑支点

- **核心原理**: **L-Sum (Nim-Sum)**。状态必败当且仅当所有堆数量的异或和为 0。
    
    _为什么是异或？_ 异或代表了某种“对称的平衡”。非 0 意味着平衡被打破，先手一定能通过修改某一位，把局面变回 0（重新平衡）。而处于 0 的人，无论怎么动，一定会把某一位变成非 0。
    
- **具体原理**:
    
    1. **标准 Nim**: $\bigoplus_{i=1}^n a_i = 0 \iff \text{P-position}$。
        
    2. **阶梯 Nim**: 石子放在 $0 \sim n$ 层阶梯上，每次将第 $i$ 层石子移向 $i-1$ 层。
        
        - **逻辑锚点**：关注**奇数层**。
            
        - **理由**：对方移动偶数层到奇数层，你只需把这些石子继续下移到下一层偶数层（抵消操作）；对方移动奇数层，等价于拿走石子。
            
        - **结论**：对所有奇数层的石子数做 Nim。
            
    3. **威佐夫博弈 (Wythoff's Game)**: 两堆石子，可从一堆或同时从两堆取走相同数量。
        
        - **结论**：若较小堆 $a$ 与差值 $b-a$ 满足 $a = \lfloor (b-a) \frac{\sqrt{5}+1}{2} \rfloor$，则先手必败。
            
## 3. 实战部署

{% fold info @代码实现: 阶梯 Nim 逻辑 %}

```cpp
void solve( )
{
    int n;
    cin >> n;
    
    int res = 0;
    for( int i = 1; i <= n; ++ i )
    {
        int x;
        cin >> x;
        // 阶梯 Nim：仅统计奇数层（从 1 开始计数的情况）
        if( i % 2 == 1 ) res ^= x;
    }
    
    if( res == 0 ) cout << "Second" << '\n';
    else cout << "First" << '\n';
}
```

{% endfold %}

## 4. 知识关联
## 4. 知识关联

- **母题**: [[P2197 模板 Nim 游戏]] —— 异或和不变量的物理原型。
    
- **实战演练**:
    
    - [[P1247 取火柴游戏]] —— 考察从 $N$ 到 $P$ 的构造性转移逻辑。
        
    - [[P2575 高手过招]] —— 阶梯 Nim 模型在棋盘空格移动中的降维映射。
        
- **关联笔记**: [[SG 函数]]